<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 5 Activity 2 | STAT764: Applied Spatio-temporal Statistics - Portfolio</title>
<meta name="author" content="Leonardo L. Bosche">
<meta name="description" content="5.1 Library library(sf) library(sp) library(raster) library(ggplot2) library(nlme) library(mapview) library(dplyr) library(gstat) library(mgcv)  5.2 Chose an area on or close to campus where it is...">
<meta name="generator" content="bookdown 0.39 with bs4_book()">
<meta property="og:title" content="Chapter 5 Activity 2 | STAT764: Applied Spatio-temporal Statistics - Portfolio">
<meta property="og:type" content="book">
<meta property="og:description" content="5.1 Library library(sf) library(sp) library(raster) library(ggplot2) library(nlme) library(mapview) library(dplyr) library(gstat) library(mgcv)  5.2 Chose an area on or close to campus where it is...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 5 Activity 2 | STAT764: Applied Spatio-temporal Statistics - Portfolio">
<meta name="twitter:description" content="5.1 Library library(sf) library(sp) library(raster) library(ggplot2) library(nlme) library(mapview) library(dplyr) library(gstat) library(mgcv)  5.2 Chose an area on or close to campus where it is...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.6.1/transition.js"></script><script src="libs/bs3compat-0.6.1/tabs.js"></script><script src="libs/bs3compat-0.6.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">STAT764: Applied Spatio-temporal Statistics - Portfolio</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> About</a></li>
<li class="book-part">JOURNALS</li>
<li><a class="" href="st-class---january-18th.html">1st class - January 18th</a></li>
<li><a class="" href="nd-class---january-25th.html">2nd class - January 25th</a></li>
<li><a class="" href="rd-class---january-30th.html">3rd class - January 30th</a></li>
<li><a class="" href="th-class---february-1st.html">4th class - February 1st</a></li>
<li><a class="" href="th-class---february-6th.html">5th class - February 6th</a></li>
<li><a class="" href="th-class---february-8th.html">6th class - February 8th</a></li>
<li><a class="" href="th-class---february-13th.html">7th class - February 13th</a></li>
<li><a class="" href="th-class---february-15th.html">8th class - February 15th</a></li>
<li><a class="" href="th-class---february-20th.html">9th class - February 20th</a></li>
<li><a class="" href="th-class---february-22th.html">10th class - February 22th</a></li>
<li><a class="" href="th-class---february-27th.html">11th class - February 27th</a></li>
<li><a class="" href="th-class---february-29th.html">12th class - February 29th</a></li>
<li><a class="" href="th-class---march-5th.html">13th class - March 5th</a></li>
<li><a class="" href="th-class---march-7th.html">14th class - March 7th</a></li>
<li><a class="" href="th-class---march-19th.html">15th class - March 19th</a></li>
<li><a class="" href="th-class---march-21st.html">16th class - March 21st</a></li>
<li><a class="" href="th-class---march-26th.html">17th class - March 26th</a></li>
<li><a class="" href="th-class---march-28th.html">18th class - March 28th</a></li>
<li><a class="" href="th-class---april-2nd.html">19th class - April 2nd</a></li>
<li><a class="" href="th-class---april-4th.html">20th class - April 4th</a></li>
<li><a class="" href="st-class---april-9th.html">21st class - April 9th</a></li>
<li><a class="" href="nd-class---april-11th.html">22nd class - April 11th</a></li>
<li><a class="" href="th-class---april-23th.html">25th class - April 23th</a></li>
<li><a class="" href="th-class---april-25th.html">26th class - April 25th</a></li>
<li><a class="" href="th-class---april-30th.html">27th class - April 30th</a></li>
<li class="book-part">ACTIVITIES</li>
<li><a class="" href="activity-1.html"><span class="header-section-number">4</span> Activity 1</a></li>
<li><a class="active" href="activity-2.html"><span class="header-section-number">5</span> Activity 2</a></li>
<li><a class="" href="activity-3.html"><span class="header-section-number">6</span> Activity 3</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/rstudio/bookdown-demo">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="activity-2" class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> Activity 2<a class="anchor" aria-label="anchor" href="#activity-2"><i class="fas fa-link"></i></a>
</h1>
<div id="library-1" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> Library<a class="anchor" aria-label="anchor" href="#library-1"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edzer/sp/">sp</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster">raster</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/nlme/">nlme</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/mapview">mapview</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/gstat/">gstat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="chose-an-area-on-or-close-to-campus-where-it-is-easy-for-you-to-understand-how-the-elevation-changes.-using-a-smartphone-record-the-elevation-at-several-locations-points-within-the-area-you-chose." class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> Chose an area on or close to campus where it is easy for you to understand how the elevation changes. Using a smartphone record the elevation at several locations (points) within the area you chose.<a class="anchor" aria-label="anchor" href="#chose-an-area-on-or-close-to-campus-where-it-is-easy-for-you-to-understand-how-the-elevation-changes.-using-a-smartphone-record-the-elevation-at-several-locations-points-within-the-area-you-chose."><i class="fas fa-link"></i></a>
</h2>
<p>Area: Agronomy North Farm (2201 North Farm - Research Center)</p>
</div>
<div id="obtain-a-.gpx-or-.csv-file-for-your-elevation-data.-at-minimum-the-file-should-contain-the-location-and-time-of-the-elevation-measurements." class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> Obtain a .gpx or .csv file for your elevation data. At minimum the file should contain the location and time of the elevation measurements.<a class="anchor" aria-label="anchor" href="#obtain-a-.gpx-or-.csv-file-for-your-elevation-data.-at-minimum-the-file-should-contain-the-location-and-time-of-the-elevation-measurements."><i class="fas fa-link"></i></a>
</h2>
<p>Data was obtained using the app Strava.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download shapefile of Kansas from census.gov</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span><span class="st">"http://www2.census.gov/geo/tiger/GENZ2015/shp/cb_2015_us_state_20m.zip"</span>, destfile <span class="op">=</span> <span class="st">"states.zip"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html">unzip</a></span><span class="op">(</span><span class="st">"states.zip"</span><span class="op">)</span></span>
<span><span class="va">sf.us</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"cb_2015_us_state_20m.shp"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Reading layer `cb_2015_us_state_20m' from data source 
##   `/Users/bosche/Desktop/stat_764_portfolio/cb_2015_us_state_20m.shp' 
##   using driver `ESRI Shapefile'
## Simple feature collection with 52 features and 9 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -179.1743 ymin: 17.91377 xmax: 179.7739 ymax: 71.35256
## Geodetic CRS:  NAD83</code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sf.kansas</span> <span class="op">&lt;-</span> <span class="va">sf.us</span><span class="op">[</span><span class="fl">48</span>,<span class="fl">6</span><span class="op">]</span></span>
<span><span class="va">sf.kansas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html">as</a></span><span class="op">(</span><span class="va">sf.kansas</span>, <span class="st">'Spatial'</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Shapefile of study area at Agronomy North Farm - KSU (Manhattan KS)</span></span>
<span><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://www.dropbox.com/scl/fi/umgo5u6ns6jkbbykqcq90/study_area.gpx?rlkey=63gjxiifvb4xq7ll25bfwyb8c&amp;dl=1"</span></span>
<span><span class="va">pt.study.area</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span>dsn<span class="op">=</span><span class="va">url</span>,layer<span class="op">=</span><span class="st">"track_points"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Reading layer `track_points' from data source 
##   `https://www.dropbox.com/scl/fi/umgo5u6ns6jkbbykqcq90/study_area.gpx?rlkey=63gjxiifvb4xq7ll25bfwyb8c&amp;dl=1' 
##   using driver `GPX'
## Simple feature collection with 122 features and 26 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -96.59424 ymin: 39.20581 xmax: -96.5938 ymax: 39.20647
## Geodetic CRS:  WGS 84</code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sf.study.area</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">pt.study.area</span><span class="op">)</span>,<span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">pt.study.area</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sf.study.area</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_buffer</a></span><span class="op">(</span><span class="va">sf.study.area</span>, <span class="fl">.00006</span><span class="op">)</span></span>
<span><span class="va">sf.study.area</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html">st_sf</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="va">sf.study.area</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html">crs</a></span><span class="op">(</span><span class="va">sf.kansas</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span><span class="op">(</span><span class="va">sf.study.area</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="activity2_NF_files/figure-html/unnamed-chunk-3-1.png" width="672"></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://www.dropbox.com/scl/fi/1b5r111l0man0la5wr1vg/NF_mungbean_trial.gpx?rlkey=80dv7ghjwt57299bwip2t4iqz&amp;dl=1"</span></span>
<span><span class="va">pt.elev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span>dsn<span class="op">=</span><span class="va">url</span>,layer<span class="op">=</span><span class="st">"track_points"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Reading layer `track_points' from data source 
##   `https://www.dropbox.com/scl/fi/1b5r111l0man0la5wr1vg/NF_mungbean_trial.gpx?rlkey=80dv7ghjwt57299bwip2t4iqz&amp;dl=1' 
##   using driver `GPX'
## Simple feature collection with 492 features and 26 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -96.59423 ymin: 39.20584 xmax: -96.59381 ymax: 39.20647
## Geodetic CRS:  WGS 84</code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pt.elev</span> <span class="op">&lt;-</span> <span class="va">pt.elev</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span> </span></code></pre></div>
</div>
<div id="plotmap-your-elevation-data.-i-would-recommend-using-r-andor-google-earth." class="section level2" number="5.4">
<h2>
<span class="header-section-number">5.4</span> Plot/map your elevation data. I would recommend using R and/or Google earth.<a class="anchor" aria-label="anchor" href="#plotmap-your-elevation-data.-i-would-recommend-using-r-andor-google-earth."><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pt.elev</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">ele</span> <span class="op">)</span>, shape <span class="op">=</span> <span class="fl">21</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Longitude'</span>, y <span class="op">=</span> <span class="st">'Latitude'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Elevation data:"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Field trial - Agronomy North Farm - KSU"</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Elevation (m)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="activity2_NF_files/figure-html/unnamed-chunk-5-1.png" width="672"></div>
</div>
<div id="create-data-frame-elevation-longitude-latitude" class="section level2" number="5.5">
<h2>
<span class="header-section-number">5.5</span> Create data frame: elevation, longitude, latitude<a class="anchor" aria-label="anchor" href="#create-data-frame-elevation-longitude-latitude"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Transform data to a planar coordinate reference system</span></span>
<span></span>
<span><span class="va">pt.elev.utm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">pt.elev</span>,<span class="fu"><a href="https://edzer.github.io/sp/reference/CRS-class.html">CRS</a></span><span class="op">(</span><span class="st">"+proj=utm +zone=14 +datum=WGS84  +units=m"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sf.study.area.utm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">sf.study.area</span>,<span class="fu"><a href="https://edzer.github.io/sp/reference/CRS-class.html">CRS</a></span><span class="op">(</span><span class="st">"+proj=utm +zone=14 +datum=WGS84  +units=m"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Create data frame</span></span>
<span><span class="va">df.elev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span> <span class="op">(</span>elev <span class="op">=</span> <span class="va">pt.elev</span><span class="op">$</span><span class="va">ele</span>,</span>
<span>                          long <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">pt.elev</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                          lat <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">pt.elev</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>                          s1 <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">pt.elev.utm</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                          s2 <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">pt.elev.utm</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>The data seems to be okay, no major problems. I’d say that I wasn’t expect to see more than 1 meter in elevation change, however I already knew this field has lower elevation towards east.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Summary statistics</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">pt.elev</span><span class="op">$</span><span class="va">ele</span><span class="op">)</span></span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   333.2   333.5   333.8   333.8   334.2   334.7</code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Box Plot</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="va">pt.elev</span><span class="op">$</span><span class="va">ele</span>, main <span class="op">=</span> <span class="st">"Elevation Boxplot"</span>, ylab <span class="op">=</span> <span class="st">"Elevation"</span>, col <span class="op">=</span> <span class="st">"navy"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="activity2_NF_files/figure-html/unnamed-chunk-7-1.png" width="672"></div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Histogram</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">pt.elev</span><span class="op">$</span><span class="va">ele</span>,col<span class="op">=</span><span class="st">"navy"</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">333</span>, <span class="fl">335</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fl">7</span>, main<span class="op">=</span><span class="st">"Histogram of elevation"</span>,xlab<span class="op">=</span><span class="st">"elevation (m)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="activity2_NF_files/figure-html/unnamed-chunk-7-2.png" width="672"></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Density Plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pt.elev</span><span class="op">$</span><span class="va">ele</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"navy"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fl">333</span>, <span class="fl">335</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Elevation Density Plot"</span>, x <span class="op">=</span> <span class="st">"Elevation"</span>, y <span class="op">=</span> <span class="st">"Density"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="activity2_NF_files/figure-html/unnamed-chunk-7-3.png" width="672"></div>
</div>
<div id="write-out-the-goals-that-you-wish-to-accomplish-using-your-elevation-data.-for-example-my-goal-was-to-make-a-map-of-the-dickens-hall-parking-lot.-this-involves-using-the-elevation-data-i-collected-to-make-predictions-of-the-elevation-at-any-possible-spatial-locations-within-the-parking-lot.-i-would-also-like-to-make-inference-about-the-location-where-the-elevation-is-lowest-within-the-parking-lot." class="section level2" number="5.6">
<h2>
<span class="header-section-number">5.6</span> Write out the goals that you wish to accomplish using your elevation data. For example, my goal was to make a map of the Dicken’s Hall parking lot. This involves using the elevation data I collected to make predictions of the elevation at any possible spatial locations within the parking lot. I would also like to make inference about the location where the elevation is lowest within the parking lot.<a class="anchor" aria-label="anchor" href="#write-out-the-goals-that-you-wish-to-accomplish-using-your-elevation-data.-for-example-my-goal-was-to-make-a-map-of-the-dickens-hall-parking-lot.-this-involves-using-the-elevation-data-i-collected-to-make-predictions-of-the-elevation-at-any-possible-spatial-locations-within-the-parking-lot.-i-would-also-like-to-make-inference-about-the-location-where-the-elevation-is-lowest-within-the-parking-lot."><i class="fas fa-link"></i></a>
</h2>
<p>My goal is to identify elevation change patterns in a specific field at Agronomy North Farm, where we plan to have an experiment this year. First of all, I wanna create an elevation map of the field, a map showing the elevation variations across the entire field. Then, I want to use the elevation data to pinpoint the lowest elevation points within the field. These areas are more susceptible to flooding and may require special attention in my experiment planning (how to place experimental blocks within the field). In addition to that, make sure the blocks are situated in areas with minimal elevation variation to minimize potential biases.</p>
</div>
<div id="write-out-several-statistical-or-machine-learning-models-that-you-think-you-can-use-to-answer-the-questionsgoals-you-wrote-in-prompt-5.-be-as-creative-and-inclusive-here.-for-each-statistical-or-machine-learning-model-make-sure-you-explain-each-component-piece-of-the-model." class="section level2" number="5.7">
<h2>
<span class="header-section-number">5.7</span> Write out several statistical or machine learning models that you think you can use to answer the questions/goals you wrote in prompt #5. Be as creative and inclusive here. For each statistical or machine learning model, make sure you explain each component (piece) of the model.<a class="anchor" aria-label="anchor" href="#write-out-several-statistical-or-machine-learning-models-that-you-think-you-can-use-to-answer-the-questionsgoals-you-wrote-in-prompt-5.-be-as-creative-and-inclusive-here.-for-each-statistical-or-machine-learning-model-make-sure-you-explain-each-component-piece-of-the-model."><i class="fas fa-link"></i></a>
</h2>
<p>Linear model:<br><span class="math inline">\(y_i = \beta_0 + \beta_1\cdot lon + \beta_2\cdot lon^2 + \beta_3\cdot lat + \beta_4\cdot lat^2 + \epsilon_i\)</span><br><span class="math inline">\(\epsilon_i \sim \mathcal{N}(0, \sigma^2)\)</span></p>
<p>GAM Model:
<span class="math inline">\(y_i= \beta_0 + f(lon, lat) + \epsilon_i\)</span><br><span class="math inline">\(\epsilon_i \sim \mathcal{N}(0, \sigma^2)\)</span></p>
</div>
<div id="of-the-models-you-developed-in-prompt-6-find-or-develop-software-to-fit-at-least-two-of-these-models-to-your-elevation-data.-note-that-in-a-perfect-world-you-would-be-able-to-either-find-existing-software-or-develop-new-programs-that-enable-you-to-fit-any-statistical-or-machine-learning-model-you-want.-in-reality-you-may-may-end-up-having-to-make-some-unwanted-changes-to-your-models-in-prompt-6-to-be-able-to-find-existing-software-to-fit-these-models-to-the-data." class="section level2" number="5.8">
<h2>
<span class="header-section-number">5.8</span> Of the models you developed in prompt #6, find (or develop) software to fit at least two of these models to your elevation data. Note that in a perfect world, you would be able to either find existing software or develop new programs that enable you to fit any statistical or machine learning model you want. In reality, you may may end up having to make some unwanted changes to your models in prompt #6 to be able to find existing software to fit these models to the data.<a class="anchor" aria-label="anchor" href="#of-the-models-you-developed-in-prompt-6-find-or-develop-software-to-fit-at-least-two-of-these-models-to-your-elevation-data.-note-that-in-a-perfect-world-you-would-be-able-to-either-find-existing-software-or-develop-new-programs-that-enable-you-to-fit-any-statistical-or-machine-learning-model-you-want.-in-reality-you-may-may-end-up-having-to-make-some-unwanted-changes-to-your-models-in-prompt-6-to-be-able-to-find-existing-software-to-fit-these-models-to-the-data."><i class="fas fa-link"></i></a>
</h2>
<div id="model-1-non-hierarchical-linear-model-with-iid-errors" class="section level3" number="5.8.1">
<h3>
<span class="header-section-number">5.8.1</span> Model 1: Non-hierarchical linear model with iid errors<a class="anchor" aria-label="anchor" href="#model-1-non-hierarchical-linear-model-with-iid-errors"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Second order polynomial model</span></span>
<span></span>
<span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">elev</span><span class="op">~</span><span class="va">s1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">s1</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="va">s2</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">s2</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,data<span class="op">=</span><span class="va">df.elev</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make raster of study area to be able to map predictions from m1</span></span>
<span><span class="va">rl.E.y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span><span class="op">(</span>,nrow<span class="op">=</span><span class="fl">100</span>,ncols<span class="op">=</span><span class="fl">100</span>,ext<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span><span class="op">(</span><span class="va">sf.study.area.utm</span><span class="op">)</span>,crs<span class="op">=</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html">crs</a></span><span class="op">(</span><span class="va">sf.study.area.utm</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make data.frame to be able to make predictions at each pixel (cell of raster)</span></span>
<span><span class="va">df.pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>elev <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                      s1 <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/xyCellFrom.html">xyFromCell</a></span><span class="op">(</span><span class="va">rl.E.y</span>,cell<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">rl.E.y</span><span class="op">[</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                      s2 <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/xyCellFrom.html">xyFromCell</a></span><span class="op">(</span><span class="va">rl.E.y</span>,cell<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">rl.E.y</span><span class="op">[</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make spatial predictions at each pixel</span></span>
<span><span class="va">df.pred</span><span class="op">$</span><span class="va">elev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">m1</span>,newdata<span class="op">=</span><span class="va">df.pred</span><span class="op">)</span> </span>
<span></span>
<span></span>
<span><span class="co"># View first 6 rows of predictions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df.pred</span><span class="op">)</span> </span></code></pre></div>
<pre><code>##       elev       s1      s2
## 1 334.2992 707720.0 4342454
## 2 334.2813 707720.5 4342454
## 3 334.2633 707721.0 4342454
## 4 334.2453 707721.5 4342454
## 5 334.2274 707722.0 4342454
## 6 334.2094 707722.5 4342454</code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fill raster file with predictions </span></span>
<span><span class="va">rl.E.y</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">df.pred</span><span class="op">$</span><span class="va">elev</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rl.E.y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/mask.html">mask</a></span><span class="op">(</span><span class="va">rl.E.y</span>,<span class="va">sf.study.area.utm</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot map of predictions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span><span class="op">(</span><span class="va">rl.E.y</span>, main <span class="op">=</span> <span class="st">"Second order polynomial regression"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span><span class="op">(</span><span class="va">sf.study.area.utm</span>,add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="activity2_NF_files/figure-html/unnamed-chunk-8-1.png" width="672"></div>
</div>
<div id="model-2-hierarchical-linear-model-with-two-error-terms-using-low-rank-approximation" class="section level3" number="5.8.2">
<h3>
<span class="header-section-number">5.8.2</span> Model 2: Hierarchical linear model with two error terms using low-rank approximation<a class="anchor" aria-label="anchor" href="#model-2-hierarchical-linear-model-with-two-error-terms-using-low-rank-approximation"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">elev</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">s1</span>,<span class="va">s2</span>,bs<span class="op">=</span><span class="st">"gp"</span>,k<span class="op">=</span><span class="fl">50</span>,m<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>,<span class="fl">10</span><span class="op">^</span><span class="fl">4</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html">gaussian</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span>,</span>
<span>          method <span class="op">=</span> <span class="st">"ML"</span>,</span>
<span>          data<span class="op">=</span><span class="va">df.elev</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## elev ~ s(s1, s2, bs = "gp", k = 50, m = c(-2, 10^4, 2))
## 
## Parametric coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 3.338e+02  3.098e-03  107775   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Approximate significance of smooth terms:
##            edf Ref.df    F p-value    
## s(s1,s2) 4.956      6 2851  &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Rank: 7/50
## R-sq.(adj) =  0.972   Deviance explained = 97.2%
## -ML = -594.17  Scale est. = 0.0047207  n = 492</code></pre>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make raster of study area to be able to map predictions from m3</span></span>
<span><span class="va">rl.E.y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span><span class="op">(</span>,nrow<span class="op">=</span><span class="fl">100</span>,ncols<span class="op">=</span><span class="fl">100</span>,ext<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span><span class="op">(</span><span class="va">sf.study.area.utm</span><span class="op">)</span>,crs<span class="op">=</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html">crs</a></span><span class="op">(</span><span class="va">sf.study.area.utm</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Make data.frame to be able to make predictions at each pixel (cell of raster)</span></span>
<span><span class="va">df.pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>elev <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                      s1 <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/xyCellFrom.html">xyFromCell</a></span><span class="op">(</span><span class="va">rl.E.y</span>,cell<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">rl.E.y</span><span class="op">[</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                      s2 <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/xyCellFrom.html">xyFromCell</a></span><span class="op">(</span><span class="va">rl.E.y</span>,cell<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">rl.E.y</span><span class="op">[</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make spatial predictions at each pixel</span></span>
<span><span class="va">df.pred</span><span class="op">$</span><span class="va">elev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">m2</span>,newdata<span class="op">=</span><span class="va">df.pred</span>,type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View first 6 rows of predictions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df.pred</span><span class="op">)</span> </span></code></pre></div>
<pre><code>##       elev       s1      s2
## 1 334.2379 707720.0 4342454
## 2 334.2175 707720.5 4342454
## 3 334.1974 707721.0 4342454
## 4 334.1774 707721.5 4342454
## 5 334.1576 707722.0 4342454
## 6 334.1380 707722.5 4342454</code></pre>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fill raster file with predictions </span></span>
<span><span class="va">rl.E.y</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">df.pred</span><span class="op">$</span><span class="va">elev</span></span>
<span></span>
<span><span class="va">rl.E.y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/mask.html">mask</a></span><span class="op">(</span><span class="va">rl.E.y</span>,<span class="va">sf.study.area.utm</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot map of predictions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span><span class="op">(</span><span class="va">rl.E.y</span>, main <span class="op">=</span> <span class="st">"Kriging"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span><span class="op">(</span><span class="va">sf.study.area.utm</span>,add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="activity2_NF_files/figure-html/unnamed-chunk-9-1.png" width="672"></div>
</div>
</div>
<div id="related-to-prompt-5-use-both-models-you-fit-to-your-elevation-data-in-prompt-7-to-answer-the-questionsgoals." class="section level2" number="5.9">
<h2>
<span class="header-section-number">5.9</span> Related to prompt #5, use both models you fit to your elevation data in prompt #7 to answer the questions/goals.<a class="anchor" aria-label="anchor" href="#related-to-prompt-5-use-both-models-you-fit-to-your-elevation-data-in-prompt-7-to-answer-the-questionsgoals."><i class="fas fa-link"></i></a>
</h2>
<p>Based on the results, since the field shows a clear lower elevation trend towards to east, we can assign blocks from west to east, in this way we would minimize bias due to elevation changes.</p>
<p>Using the second model, which seems to predict better the elevation pattern:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make spatial predictions at each pixel</span></span>
<span><span class="va">df.pred</span><span class="op">$</span><span class="va">elev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">m1</span>,newdata<span class="op">=</span><span class="va">df.pred</span>,type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fill raster file with predictions </span></span>
<span><span class="va">rl.E.y</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">df.pred</span><span class="op">$</span><span class="va">elev</span></span>
<span></span>
<span><span class="co"># Estimate coordinates and point of minimum elevation</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/xyCellFrom.html">xyFromCell</a></span><span class="op">(</span><span class="va">rl.E.y</span>,cell<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="va">rl.E.y</span><span class="op">[</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>##             x       y
## [1,] 707769.2 4342454</code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rl.E.y</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="va">rl.E.y</span><span class="op">[</span><span class="op">]</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code>## [1] 332.5205</code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot estimate coordinates of maximum elevation</span></span>
<span></span>
<span><span class="va">rl.E.y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/mask.html">mask</a></span><span class="op">(</span><span class="va">rl.E.y</span>,<span class="va">sf.study.area.utm</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span><span class="op">(</span><span class="va">rl.E.y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span><span class="op">(</span><span class="va">sf.study.area.utm</span>,add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/xyCellFrom.html">xyFromCell</a></span><span class="op">(</span><span class="va">rl.E.y</span>,cell<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="va">rl.E.y</span><span class="op">[</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"tomato"</span>,pch<span class="op">=</span><span class="st">"x"</span>,cex<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="activity2_NF_files/figure-html/unnamed-chunk-10-1.png" width="672"></div>
</div>
<div id="based-on-the-material-in-chapter-6-of-spatio-temporal-statistics-with-r-and-our-discussion-in-class-on-march-26-compare-check-and-evaluate-the-two-models-from-8" class="section level2" number="5.10">
<h2>
<span class="header-section-number">5.10</span> Based on the material in Chapter 6 of Spatio-Temporal Statistics with R and our discussion in class on March 26, compare, check and evaluate the two models from #8<a class="anchor" aria-label="anchor" href="#based-on-the-material-in-chapter-6-of-spatio-temporal-statistics-with-r-and-our-discussion-in-class-on-march-26-compare-check-and-evaluate-the-two-models-from-8"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create train and test data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">trainIndices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df.elev</span><span class="op">)</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="fl">0.7</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df.elev</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Subset the data into train and test sets</span></span>
<span><span class="va">train_df</span> <span class="op">&lt;-</span> <span class="va">df.elev</span><span class="op">[</span><span class="va">trainIndices</span>, <span class="op">]</span></span>
<span><span class="va">test_df</span> <span class="op">&lt;-</span> <span class="va">df.elev</span><span class="op">[</span><span class="op">-</span><span class="va">trainIndices</span>, <span class="op">]</span></span></code></pre></div>
</div>
<div id="fit-m1-using-train-df" class="section level2" number="5.11">
<h2>
<span class="header-section-number">5.11</span> Fit m1 using train df<a class="anchor" aria-label="anchor" href="#fit-m1-using-train-df"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Second order polynomial model</span></span>
<span></span>
<span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">elev</span><span class="op">~</span><span class="va">s1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">s1</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="va">s2</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">s2</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,data<span class="op">=</span><span class="va">train_df</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make raster of study area to be able to map predictions from m1</span></span>
<span><span class="va">rl.E.y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span><span class="op">(</span>,nrow<span class="op">=</span><span class="fl">100</span>,ncols<span class="op">=</span><span class="fl">100</span>,ext<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span><span class="op">(</span><span class="va">sf.study.area.utm</span><span class="op">)</span>,crs<span class="op">=</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html">crs</a></span><span class="op">(</span><span class="va">sf.study.area.utm</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make data.frame to be able to make predictions at each pixel (cell of raster)</span></span>
<span><span class="va">df.pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>elev <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                      s1 <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/xyCellFrom.html">xyFromCell</a></span><span class="op">(</span><span class="va">rl.E.y</span>,cell<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">rl.E.y</span><span class="op">[</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                      s2 <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/xyCellFrom.html">xyFromCell</a></span><span class="op">(</span><span class="va">rl.E.y</span>,cell<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">rl.E.y</span><span class="op">[</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make spatial predictions at each pixel</span></span>
<span><span class="va">df.pred</span><span class="op">$</span><span class="va">elev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">m1</span>,newdata<span class="op">=</span><span class="va">df.pred</span><span class="op">)</span> </span>
<span></span>
<span></span>
<span><span class="co"># View first 6 rows of predictions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df.pred</span><span class="op">)</span> </span></code></pre></div>
<pre><code>##       elev       s1      s2
## 1 334.3000 707720.0 4342454
## 2 334.2822 707720.5 4342454
## 3 334.2645 707721.0 4342454
## 4 334.2467 707721.5 4342454
## 5 334.2289 707722.0 4342454
## 6 334.2112 707722.5 4342454</code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fill raster file with predictions </span></span>
<span><span class="va">rl.E.y</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">df.pred</span><span class="op">$</span><span class="va">elev</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rl.E.y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/mask.html">mask</a></span><span class="op">(</span><span class="va">rl.E.y</span>,<span class="va">sf.study.area.utm</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot map of predictions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span><span class="op">(</span><span class="va">rl.E.y</span>, main <span class="op">=</span> <span class="st">"Second order polynomial regression"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span><span class="op">(</span><span class="va">sf.study.area.utm</span>,add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="activity2_NF_files/figure-html/unnamed-chunk-12-1.png" width="672"></div>
</div>
<div id="fit-m2-using-train-df" class="section level2" number="5.12">
<h2>
<span class="header-section-number">5.12</span> Fit m2 using train df<a class="anchor" aria-label="anchor" href="#fit-m2-using-train-df"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">elev</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">s1</span>,<span class="va">s2</span>,bs<span class="op">=</span><span class="st">"gp"</span>,k<span class="op">=</span><span class="fl">50</span>,m<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>,<span class="fl">10</span><span class="op">^</span><span class="fl">4</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html">gaussian</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span>,</span>
<span>          method <span class="op">=</span> <span class="st">"ML"</span>,</span>
<span>          data<span class="op">=</span><span class="va">train_df</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## elev ~ s(s1, s2, bs = "gp", k = 50, m = c(-2, 10^4, 2))
## 
## Parametric coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 3.338e+02  3.776e-03   88396   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Approximate significance of smooth terms:
##           edf Ref.df    F p-value    
## s(s1,s2) 4.94      6 1903  &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Rank: 7/50
## R-sq.(adj) =  0.971   Deviance explained = 97.1%
## -ML = -402.09  Scale est. = 0.0049059  n = 344</code></pre>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make raster of study area to be able to map predictions from m3</span></span>
<span><span class="va">rl.E.y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span><span class="op">(</span>,nrow<span class="op">=</span><span class="fl">100</span>,ncols<span class="op">=</span><span class="fl">100</span>,ext<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span><span class="op">(</span><span class="va">sf.study.area.utm</span><span class="op">)</span>,crs<span class="op">=</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html">crs</a></span><span class="op">(</span><span class="va">sf.study.area.utm</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Make data.frame to be able to make predictions at each pixel (cell of raster)</span></span>
<span><span class="va">df.pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>elev <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                      s1 <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/xyCellFrom.html">xyFromCell</a></span><span class="op">(</span><span class="va">rl.E.y</span>,cell<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">rl.E.y</span><span class="op">[</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                      s2 <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/xyCellFrom.html">xyFromCell</a></span><span class="op">(</span><span class="va">rl.E.y</span>,cell<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">rl.E.y</span><span class="op">[</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make spatial predictions at each pixel</span></span>
<span><span class="va">df.pred</span><span class="op">$</span><span class="va">elev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">m2</span>,newdata<span class="op">=</span><span class="va">df.pred</span>,type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View first 6 rows of predictions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df.pred</span><span class="op">)</span> </span></code></pre></div>
<pre><code>##       elev       s1      s2
## 1 334.2387 707720.0 4342454
## 2 334.2183 707720.5 4342454
## 3 334.1981 707721.0 4342454
## 4 334.1781 707721.5 4342454
## 5 334.1582 707722.0 4342454
## 6 334.1386 707722.5 4342454</code></pre>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fill raster file with predictions </span></span>
<span><span class="va">rl.E.y</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">df.pred</span><span class="op">$</span><span class="va">elev</span></span>
<span></span>
<span><span class="va">rl.E.y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/mask.html">mask</a></span><span class="op">(</span><span class="va">rl.E.y</span>,<span class="va">sf.study.area.utm</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot map of predictions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span><span class="op">(</span><span class="va">rl.E.y</span>, main <span class="op">=</span> <span class="st">"Kriging"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span><span class="op">(</span><span class="va">sf.study.area.utm</span>,add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="activity2_NF_files/figure-html/unnamed-chunk-13-1.png" width="672"></div>
</div>
<div id="compare-point-prediction-of-the-the-expected-value-of-elevation-ey-to-observed-records-from-test-data-set." class="section level2" number="5.13">
<h2>
<span class="header-section-number">5.13</span> Compare point prediction of the the expected value of elevation (E(y)) to observed records from test data set.<a class="anchor" aria-label="anchor" href="#compare-point-prediction-of-the-the-expected-value-of-elevation-ey-to-observed-records-from-test-data-set."><i class="fas fa-link"></i></a>
</h2>
<div id="m1" class="section level3" number="5.13.1">
<h3>
<span class="header-section-number">5.13.1</span> m1<a class="anchor" aria-label="anchor" href="#m1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">E.y.m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">m1</span>,newdata<span class="op">=</span><span class="va">test_df</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span><span class="op">(</span><span class="va">E.y.m1</span>,<span class="va">test_df</span><span class="op">$</span><span class="va">elev</span>,xlab<span class="op">=</span><span class="st">"Predicted expected value"</span>,ylab<span class="op">=</span><span class="st">"New observed elevation"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="activity2_NF_files/figure-html/unnamed-chunk-14-1.png" width="672"></div>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Quantify predictive accuracy using scoring rule </span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">test_df</span><span class="op">$</span><span class="va">elev</span>,<span class="va">E.y.m1</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="co"># logarithmic scoring rule (proper scoring rule for linear model)</span></span></code></pre></div>
<pre><code>## [1] -136.5505</code></pre>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">test_df</span><span class="op">$</span><span class="va">elev</span> <span class="op">-</span> <span class="va">E.y.m1</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="co"># Mean square error. Commonly used scoring rule, but not proper scoring rule for ALL situations</span></span></code></pre></div>
<pre><code>## [1] 0.00739952</code></pre>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">test_df</span><span class="op">$</span><span class="va">elev</span> <span class="op">-</span> <span class="va">E.y.m1</span><span class="op">)</span><span class="op">)</span> <span class="co"># Mean absolute error. Commonly used scoring rule, but not proper scoring rule for ALL situations</span></span></code></pre></div>
<pre><code>## [1] 0.06668116</code></pre>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Quantify calibration of predictive intervals. </span></span>
<span></span>
<span><span class="va">PI.m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">m1</span>,newdata<span class="op">=</span><span class="va">test_df</span>,</span>
<span>               interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"prediction"</span><span class="op">)</span>,</span>
<span>               level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Determine what % of the new observations fall within the prediction intervals.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">test_df</span><span class="op">$</span><span class="va">elev</span><span class="op">&gt;</span><span class="va">PI.m1</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">test_df</span><span class="op">$</span><span class="va">elev</span><span class="op">&lt;</span><span class="va">PI.m1</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 0.9662162</code></pre>
</div>
<div id="m2" class="section level3" number="5.13.2">
<h3>
<span class="header-section-number">5.13.2</span> m2<a class="anchor" aria-label="anchor" href="#m2"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">E.y.m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">m2</span>,newdata<span class="op">=</span><span class="va">test_df</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span><span class="op">(</span><span class="va">E.y.m2</span>,<span class="va">test_df</span><span class="op">$</span><span class="va">elev</span>,xlab<span class="op">=</span><span class="st">"Predicted expected value"</span>,ylab<span class="op">=</span><span class="st">"New observed elevation"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="activity2_NF_files/figure-html/unnamed-chunk-15-1.png" width="672"></div>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Quantify predictive accuracy using scoring rule </span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">test_df</span><span class="op">$</span><span class="va">elev</span>,<span class="va">E.y.m2</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="co"># logarithmic scoring rule (proper scoring rule for linear model)</span></span></code></pre></div>
<pre><code>## [1] -136.3232</code></pre>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">test_df</span><span class="op">$</span><span class="va">elev</span> <span class="op">-</span> <span class="va">E.y.m2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="co"># Mean square error. Commonly used scoring rule, but not proper scoring rule for ALL situations</span></span></code></pre></div>
<pre><code>## [1] 0.004328524</code></pre>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">test_df</span><span class="op">$</span><span class="va">elev</span> <span class="op">-</span> <span class="va">E.y.m2</span><span class="op">)</span><span class="op">)</span> <span class="co"># Mean absolute error. Commonly used scoring rule, but not proper scoring rule for ALL situations</span></span></code></pre></div>
<pre><code>## [1] 0.05134698</code></pre>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Quantify calibration of predictive intervals. </span></span>
<span></span>
<span><span class="va">PI.m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">m2</span>,newdata<span class="op">=</span><span class="va">test_df</span>,</span>
<span>               interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"prediction"</span><span class="op">)</span>,</span>
<span>               level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span></code></pre></div>
<p>In summary, comparing both models, the m2 (GAM) was the best model, presenting lower logarithmic scoring rule, MSE and MAE.</p>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="activity-1.html"><span class="header-section-number">4</span> Activity 1</a></div>
<div class="next"><a href="activity-3.html"><span class="header-section-number">6</span> Activity 3</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#activity-2"><span class="header-section-number">5</span> Activity 2</a></li>
<li><a class="nav-link" href="#library-1"><span class="header-section-number">5.1</span> Library</a></li>
<li><a class="nav-link" href="#chose-an-area-on-or-close-to-campus-where-it-is-easy-for-you-to-understand-how-the-elevation-changes.-using-a-smartphone-record-the-elevation-at-several-locations-points-within-the-area-you-chose."><span class="header-section-number">5.2</span> Chose an area on or close to campus where it is easy for you to understand how the elevation changes. Using a smartphone record the elevation at several locations (points) within the area you chose.</a></li>
<li><a class="nav-link" href="#obtain-a-.gpx-or-.csv-file-for-your-elevation-data.-at-minimum-the-file-should-contain-the-location-and-time-of-the-elevation-measurements."><span class="header-section-number">5.3</span> Obtain a .gpx or .csv file for your elevation data. At minimum the file should contain the location and time of the elevation measurements.</a></li>
<li><a class="nav-link" href="#plotmap-your-elevation-data.-i-would-recommend-using-r-andor-google-earth."><span class="header-section-number">5.4</span> Plot/map your elevation data. I would recommend using R and/or Google earth.</a></li>
<li><a class="nav-link" href="#create-data-frame-elevation-longitude-latitude"><span class="header-section-number">5.5</span> Create data frame: elevation, longitude, latitude</a></li>
<li><a class="nav-link" href="#write-out-the-goals-that-you-wish-to-accomplish-using-your-elevation-data.-for-example-my-goal-was-to-make-a-map-of-the-dickens-hall-parking-lot.-this-involves-using-the-elevation-data-i-collected-to-make-predictions-of-the-elevation-at-any-possible-spatial-locations-within-the-parking-lot.-i-would-also-like-to-make-inference-about-the-location-where-the-elevation-is-lowest-within-the-parking-lot."><span class="header-section-number">5.6</span> Write out the goals that you wish to accomplish using your elevation data. For example, my goal was to make a map of the Dicken’s Hall parking lot. This involves using the elevation data I collected to make predictions of the elevation at any possible spatial locations within the parking lot. I would also like to make inference about the location where the elevation is lowest within the parking lot.</a></li>
<li><a class="nav-link" href="#write-out-several-statistical-or-machine-learning-models-that-you-think-you-can-use-to-answer-the-questionsgoals-you-wrote-in-prompt-5.-be-as-creative-and-inclusive-here.-for-each-statistical-or-machine-learning-model-make-sure-you-explain-each-component-piece-of-the-model."><span class="header-section-number">5.7</span> Write out several statistical or machine learning models that you think you can use to answer the questions/goals you wrote in prompt #5. Be as creative and inclusive here. For each statistical or machine learning model, make sure you explain each component (piece) of the model.</a></li>
<li>
<a class="nav-link" href="#of-the-models-you-developed-in-prompt-6-find-or-develop-software-to-fit-at-least-two-of-these-models-to-your-elevation-data.-note-that-in-a-perfect-world-you-would-be-able-to-either-find-existing-software-or-develop-new-programs-that-enable-you-to-fit-any-statistical-or-machine-learning-model-you-want.-in-reality-you-may-may-end-up-having-to-make-some-unwanted-changes-to-your-models-in-prompt-6-to-be-able-to-find-existing-software-to-fit-these-models-to-the-data."><span class="header-section-number">5.8</span> Of the models you developed in prompt #6, find (or develop) software to fit at least two of these models to your elevation data. Note that in a perfect world, you would be able to either find existing software or develop new programs that enable you to fit any statistical or machine learning model you want. In reality, you may may end up having to make some unwanted changes to your models in prompt #6 to be able to find existing software to fit these models to the data.</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#model-1-non-hierarchical-linear-model-with-iid-errors"><span class="header-section-number">5.8.1</span> Model 1: Non-hierarchical linear model with iid errors</a></li>
<li><a class="nav-link" href="#model-2-hierarchical-linear-model-with-two-error-terms-using-low-rank-approximation"><span class="header-section-number">5.8.2</span> Model 2: Hierarchical linear model with two error terms using low-rank approximation</a></li>
</ul>
</li>
<li><a class="nav-link" href="#related-to-prompt-5-use-both-models-you-fit-to-your-elevation-data-in-prompt-7-to-answer-the-questionsgoals."><span class="header-section-number">5.9</span> Related to prompt #5, use both models you fit to your elevation data in prompt #7 to answer the questions/goals.</a></li>
<li><a class="nav-link" href="#based-on-the-material-in-chapter-6-of-spatio-temporal-statistics-with-r-and-our-discussion-in-class-on-march-26-compare-check-and-evaluate-the-two-models-from-8"><span class="header-section-number">5.10</span> Based on the material in Chapter 6 of Spatio-Temporal Statistics with R and our discussion in class on March 26, compare, check and evaluate the two models from #8</a></li>
<li><a class="nav-link" href="#fit-m1-using-train-df"><span class="header-section-number">5.11</span> Fit m1 using train df</a></li>
<li><a class="nav-link" href="#fit-m2-using-train-df"><span class="header-section-number">5.12</span> Fit m2 using train df</a></li>
<li>
<a class="nav-link" href="#compare-point-prediction-of-the-the-expected-value-of-elevation-ey-to-observed-records-from-test-data-set."><span class="header-section-number">5.13</span> Compare point prediction of the the expected value of elevation (E(y)) to observed records from test data set.</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#m1"><span class="header-section-number">5.13.1</span> m1</a></li>
<li><a class="nav-link" href="#m2"><span class="header-section-number">5.13.2</span> m2</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/rstudio/bookdown-demo/blob/master/activity2_NF.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/rstudio/bookdown-demo/edit/master/activity2_NF.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>STAT764: Applied Spatio-temporal Statistics - Portfolio</strong>" was written by Leonardo L. Bosche. It was last built on 2024-05-08.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
